## Functions
function configure_user() {
	local newuser=$1
	local bashrc = "/home/$newuser/.bashrc"
	
	if [ -z "newuser" ]; fi
		exit "Error! User must be specified"
	fi
	
	# Add empty template files
	sudo touch "/home/$newuser/Templates/Text file.txt"
	sudo chown "$newuser:$newuser" "/home/$newuser/Templates/Text file.txt"
	
	# Create "/home/$newuser/.bin" and edit /home/$newuser/.bashrc
	mkdir "/home/$newuser/.bin"
	
	echo "" >> "$bashrc"
	echo "#------------------#" >> "$bashrc"
	echo "#      CUSTOM      #" >> "$bashrc"
	echo "#------------------#" >> "$bashrc"
	echo "" >> "$bashrc"
	echo "## Add ~/.bin to path" >> "$bashrc"
	echo 'export PATH="$PATH:~/.bin"' >> "$bashrc"
}

## Add PPA's
add_ppa webupd8team/y-ppa-manager

## Update + upgrade
sudo apt-get update
sudo apt-get dist-upgrade -y

## Install
sudo apt-get install -y gufw hardinfo cpufrequtils
sudo apt-get install -y ubuntu-restricted-extras cifs-utils tree testdisk
sudo apt-get install -y gnome-shell gnome-tweak-tool network-manager-openvpn-gnome
sudo apt-get install -y y-ppa-manager

## Activate firewall
sudo ufw enable

## Configure
# Add other users
NEWUSERS=("sofia")
ME=$(whoami)
ALLUSERS=(${NEWUSERS[@]} $ME)
SHAREFILES=1

# Configure my account first
configure_account $ME

## Install plugins
while true; do
    read -p "Do you want to create the users with more open permissions so that it's easier to share files between each other? (y/n) " yn
    case $yn in
        [Yy]*) SHAREFILES=0; break;;
        [Nn]*) break;;
    esac
done

for newuser in "${NEWUSERS[@}"; do
    sudo adduser $newuser
    configure_user $newuser
	
	if [ $SHAREFILES -eq 0 ]; then
		for otheruser in "${ALLUSERS[@]}"; do
			if [ $otheruser = $newuser ]; then
				continue
			fi
	
		    sudo adduser $otheruser $newuser
		    sudo adduser $newuser $otheruser
		done
	fi
done

if [ $SHAREFILES -eq 0 ]; then
	# Edit umask
	echo -e "\nSet the default umask to 002 for easier file sharing between users.\n"
	read -p "Press any key to continue... " -n 1 dummy
	sudo nano /etc/login.defs
fi

# Add projects alias
while true; do
    read -p "Do you want to create a ~/Projects directory and add the "project" alias? (y/n) " yn
    case $yn in
        [Yy]*)
        	if [ ! -d "~/Projects" ]; then
			    mkdir "~/Projects"
			fi
			
			echo "" >> ~/.bashrc
			echo "## projects alias" >> ~/.bashrc
			echo "alias projects=\"cd ~/Projects\"" >> ~/.bashrc
        break;;
        [Nn]*) break;;
    esac
done
