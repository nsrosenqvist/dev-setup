## Functions
function configure_user() {
	local newuser=$1
	local bashrc = "/home/$newuser/.bashrc"

	if [ -z "$newuser" ]; then
		exit "Error! User must be specified"
	fi

	# Add empty template files
	sudo touch "/home/$newuser/Templates/Text file.txt"
	sudo chown "$newuser:$newuser" "/home/$newuser/Templates/Text file.txt"

	# Create "/home/$newuser/.bin" and edit /home/$newuser/.bashrc
	mkdir "/home/$newuser/.bin"

	echo "" >> "$bashrc"
	echo "#------------------#" >> "$bashrc"
	echo "#      CUSTOM      #" >> "$bashrc"
	echo "#------------------#" >> "$bashrc"
	echo "" >> "$bashrc"
	echo "## Add ~/.bin to path" >> "$bashrc"
	echo 'export PATH="$PATH:~/.bin"' >> "$bashrc"
}

## Add PPA's
add_ppa webupd8team/y-ppa-manager
add_ppa danielrichter2007/grub-customizer

## Update + upgrade
sudo apt-get update
sudo apt-get dist-upgrade -y

## Install
sudo apt-get install -y gufw hardinfo cpufrequtils grub-customizer nautilus-open-terminal
sudo apt-get install -y ubuntu-restricted-extras cifs-utils tree testdisk exfat-fuse exfat-utils hfsprogs hfsplus udftools
sudo apt-get install -y gnome-shell gnome-tweak-tool network-manager-openvpn-gnome
sudo apt-get install -y y-ppa-manager

## Activate firewall
sudo ufw enable

## Configure users
ME=$(whoami)
SHAREFILES=1

# Configure my account first
configure_account $ME
# Take control of /opt
sudo chown "$ME:$ME" /opt

# Ask if to improve sharing of files
while true; do
	read -p "Do you want to create the users with more open permissions so that it's easier to share files between each other? (y/n) " yn
	case $yn in
		[Yy]*) SHAREFILES=0; break;;
		[Nn]*) break;;
	esac
done

# Create new users
read -p "Enter the user names of the new users: " input
NEWUSERS=("$input")
ALLUSERS=(${NEWUSERS[@]} $ME)

for newuser in "${NEWUSERS[@]}"; do
	sudo adduser $newuser
	configure_user $newuser

	if [ $SHAREFILES -eq 0 ]; then
		for otheruser in "${ALLUSERS[@]}"; do
			if [ $otheruser = $newuser ]; then
				continue
			fi

			sudo adduser $otheruser $newuser
			sudo adduser $newuser $otheruser
		done
	fi
done

# Configure admin privileges
echo -e "\nEnter the users that should be given super user permissions:"
echo -e "\n${NEWUSERS[@]}\n"
read -p "Sudoers: " input
SUDOERS=("$input")

for sudoer in "${SUDOERS[@]}"; do
	sudo adduser $newuser sudo
done

# Edit the umask
if [ $SHAREFILES -eq 0 ]; then
	# Edit umask
	echo -e "\nSet the default umask to 002 for easier file sharing between users.\n"
	read -p "Press any key to continue... " -n 1 dummy
	sudo nano /etc/login.defs
fi

## Add projects alias
while true; do
	read -p "Do you want to create a ~/Projects directory and add the "project" alias? (y/n) " yn
	case $yn in
		[Yy]*)
			if [ ! -d "$HOME/Projects" ]; then
				mkdir "$HOME/Projects"
			fi

			echo "" >> ~/.bashrc
			echo "## projects alias" >> ~/.bashrc
			echo "alias projects=\"cd ~/Projects\"" >> ~/.bashrc
        	break;;
        	[Nn]*) break;;
        esac
done
